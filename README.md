# QA Система для нормативных документов ЖКХ

**Дата:** 2026-01-09
**Директория:** `/home/olga/normativ_docs/Волков/`
**Статус:** Production-ready

---

## Описание проекта

Система для семантического поиска по нормативным документам ЖКХ РФ с использованием AI.

**Возможности:**
- Поиск по 18 федеральным нормативным документам (кодексы, постановления, приказы, письма)
- Переформулирование запросов в термины нормативных актов через YandexGPT
- Упрощение юридического текста на простой язык
- Веб-интерфейс для поиска и API для интеграции

**База данных:**
- Кодексы РФ: ГК РФ (ч.1, ч.2), ЖК РФ
- Федеральные законы: ФЗ-152, ФЗ-190, ФЗ-261
- Постановления Правительства РФ: 354, 306, 491, 124, 290, 75, 416, 1110
- Приказы Минстроя: 938 пр, 44 пр
- Письма Минстроя: 9667-ОД-04, 50534-ОГ-04

---

## Быстрый старт

### Шаг 1: Запустить бэкенд

```bash
cd /home/olga/normativ_docs/Волков
python vector-db-test/backend/main_cpu.py
```

**Ожидаемый вывод:**
```
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8001
```

### Шаг 2: Запустить фронтенд (в новом терминале)

```bash
cd /home/olga/normativ_docs/Волков
python run_frontend_server.py
```

**Ожидаемый вывод:**
```
============================================================
ЗАПУСК ФРОНТЕНДА QA СИСТЕМЫ
============================================================
URL: http://localhost:8080
============================================================
```

### Шаг 3: Открыть в браузере

Перейти на: http://localhost:8080

---

## Структура проекта

```
/home/olga/normativ_docs/Волков/
├── README.md                      # Этот файл
├── config.py                      # Конфигурация
├── .env                           # Секреты (API ключи)
│
├── инструкции/                    # Подробная документация
│   ├── ОГЛАВЛЕНИЕ.md              # Обзор всех инструкций
│   ├── ИНСТРУКЦИЯ.md              # Работа с документами
│   ├── ИНДЕКСЫ.md                 # Векторные индексы
│   ├── ФРОНТЕНД_И_БЭКЕНД.md       # Веб-интерфейс и API
│   ├── ЛОГИ_И_КОНФИГУРАЦИЯ.md     # Логи и конфигурация
│   └── ПРОМПТЫ_ПРИЛОЖЕНИЯ.md      # Промпты YandexGPT
│
├── vector-db-test/
│   ├── backend/
│   │   └── main_cpu.py            # FastAPI бэкенд (порт 8001)
│   ├── vectordb/                  # 18 векторных баз FAISS
│   └── logs/                      # Логи бэкенда
│
├── frontend/
│   └── index.html                 # Веб-интерфейс
│
├── fulldocx/                      # Исходные документы DOCX
├── reports/                       # JSON отчеты по чанкам
├── logs/                          # Общие логи
│
├── universal_chunker.py           # Разбивка документов на чанки
├── check_chunk_quality.py         # Проверка качества чанков
├── document_processor.py          # Создание векторных баз
└── run_frontend_server.py         # Запуск фронтенда
```

---

## Подробная документация

Вся подробная документация находится в папке `инструкции/`:

1. **[ОГЛАВЛЕНИЕ.md](инструкции/ОГЛАВЛЕНИЕ.md)** - Начните здесь
   - Обзор всей документации
   - Порядок чтения
   - Быстрый старт для разных задач

2. **[ИНСТРУКЦИЯ.md](инструкции/ИНСТРУКЦИЯ.md)** - Работа с документами
   - Как подготовить новый документ
   - Как протестировать разбиение на чанки
   - Как создать векторную базу

3. **[ИНДЕКСЫ.md](инструкции/ИНДЕКСЫ.md)** - Векторные базы
   - Список всех 18 индексов
   - Проверка работы индекса
   - Пересоздание базы

4. **[ФРОНТЕНД_И_БЭКЕНД.md](инструкции/ФРОНТЕНД_И_БЭКЕНД.md)** - Веб-интерфейс и API
   - Запуск системы
   - API endpoints
   - Диагностика проблем

5. **[ЛОГИ_И_КОНФИГУРАЦИЯ.md](инструкции/ЛОГИ_И_КОНФИГУРАЦИЯ.md)** - Конфигурация
   - Настройка .env
   - Логирование
   - Диагностика

6. **[ПРОМПТЫ_ПРИЛОЖЕНИЯ.md](инструкции/ПРОМПТЫ_ПРИЛОЖЕНИЯ.md)** - Промпты YandexGPT
   - Все 4 промпта
   - История изменений
   - Настройка

---

## Требования

### Python пакеты:

```bash
pip install fastapi uvicorn
pip install sentence-transformers
pip install langchain-community
pip install python-dotenv
pip install faiss-cpu
pip install python-docx
```

### Модели:

- **Embeddings:** `intfloat/multilingual-e5-base` (автозагрузка при первом запуске)
- **LLM:** YandexGPT (требуется API ключ)

### API ключи:

Требуется YandexGPT API ключ. Настроить в `.env`:

```bash
YANDEX_API_KEY=ваш_ключ
YANDEX_FOLDER_ID=ваш_folder_id
```

---

## Быстрый старт разработки

### Добавление нового документа в базу:

```bash
cd /home/olga/normativ_docs/Волков

# 1. Положить DOCX файл в fulldocx/
cp "Новый_документ.docx" fulldocx/

# 2. Протестировать разбиение на чанки
python universal_chunker.py "Новый_документ.docx"

# 3. Проверить качество чанков (опционально)
python check_chunk_quality.py reports/test_chunks_<тип>.json "Новый документ"

# 4. Создать векторную базу
python document_processor.py "Новый_документ.docx"

# 5. Проверить через фронтенд
# Открыть http://localhost:8080 и ввести запрос
```

**Подробнее:** См. [ИНСТРУКЦИЯ.md](инструкции/ИНСТРУКЦИЯ.md)

### Тестирование API:

```bash
# Проверка здоровья
curl http://localhost:8001/health

# Поиск по документам
curl -X POST http://localhost:8001/llm-search \
  -H "Content-Type: application/json" \
  -d '{"query": "как сменить УК", "database": "current"}'
```

**Подробнее:** См. [ФРОНТЕНД_И_БЭКЕНД.md](инструкции/ФРОНТЕНД_И_БЭКЕНД.md)

---

## API Endpoints

Бэкенд (FastAPI) предоставляет следующие endpoints:

### 1. POST `/llm-search` - Поиск с LLM ответом

**Запрос:**
```json
{
  "query": "как сменить УК",
  "database": "current"
}
```

**Ответ:**
```json
{
  "answer": "УК можно сменить через...",
  "sources": [
    {
      "document": "Жилищный кодекс РФ",
      "article": "ст. 44",
      "content": "Текст фрагмента..."
    }
  ],
  "reformulated_query": "расторжение договора управления...",
  "tokens_used": 500
}
```

### 2. POST `/search` - Простой поиск

**Запрос:**
```json
{
  "query": "коммунальные услуги",
  "top_k": 5
}
```

**Ответ:**
```json
{
  "results": [
    {
      "content": "Текст фрагмента...",
      "metadata": {
        "document": "ПП РФ № 354",
        "article": "п. 5"
      },
      "similarity": 0.95
    }
  ]
}
```

### 3. GET `/health` - Проверка здоровья

**Ответ:**
```json
{
  "status": "ok"
}
```

### 4. POST `/simplify` - Упрощение текста

**Запрос:**
```json
{
  "text": "Граждане снимаются с учета...",
  "max_length": 300
}
```

**Ответ:**
```json
{
  "original_text": "Граждане снимаются...",
  "simplified_text": "**Главное:** ...",
  "tokens_used": 150
}
```

**Документация API:** http://localhost:8001/docs (Swagger UI)

---

## Примеры запросов для тестирования

### Базовые запросы:
1. "как сменить управляющую компанию"
2. "что входит в состав общего имущества"
3. "какие коммунальные услуги предоставляются"
4. "кто несет ответственность за качество воды"
5. "как производится расчет платы за ЖКХ"

### Сложные запросы:
1. "порядок проведения общего собрания собственников"
2. "правила установления нормативов потребления"
3. "требования к протоколам общих собраний"
4. "минимальный перечень услуг и работ по содержанию МКД"

---

## Диагностика проблем

### Проблема: Бэкенд не запускается

**Ошибка:** `ModuleNotFoundError: No module named 'fastapi'`

**Решение:**
```bash
pip install fastapi uvicorn
```

### Проблема: Фронтенд не подключается к API

**Ошибка:** `Connection refused` в консоли браузера

**Решение:**
1. Проверить что бэкенд запущен: `curl http://localhost:8001/health`
2. Проверить порт в `frontend/index.html` (переменная `API_URL`)
3. Проверить CORS заголовки в бэкенде

### Проблема: Векторная база не найдена

**Ошибка:** `FileNotFoundError: vectordb/...`

**Решение:**
1. Проверить что база создана: `ls vector-db-test/vectordb/`
2. Если базы нет - создать: `python document_processor.py "Документ.docx"`

### Проблема: YandexGPT не работает

**Ошибка:** `YANDEX_API_KEY is not set`

**Решение:**
1. Проверить что .env существует: `ls -la .env`
2. Проверить содержимое .env: `cat .env`
3. Добавить ключи:
```bash
YANDEX_API_KEY=ваш_ключ
YANDEX_FOLDER_ID=ваш_folder_id
```

**Подробнее:** См. [ЛОГИ_И_КОНФИГУРАЦИЯ.md](инструкции/ЛОГИ_И_КОНФИГУРАЦИЯ.md)

---

## Интеграция с komunal-dom.ru

### Пример интеграции через Python:

```python
import requests

# Запрос к QA системе
response = requests.post(
    "http://localhost:8001/llm-search",
    json={
        "query": "как сменить УК",
        "database": "current"
    }
)

result = response.json()

# Использование ответа
answer = result['answer']
sources = result['sources']

print(f"Ответ: {answer}")
print(f"Источники: {sources}")
```

### Настройка CORS для внешних запросов:

В файле `vector-db-test/backend/main_cpu.py` добавлены CORS middleware:

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # В продакшене ограничить
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## Текущий статус базы данных

**Всего индексов:** 18

**Отсутствуют:**
- ФЗ-35 "Об электроэнергетике" (планируется добавить)

**Ограничения:**
- Только федеральные нормативные акты
- Региональные законы отсутствуют
- Административные процедуры (МФЦ, Госуслуги) отсутствуют

**Подробнее:** См. `инструкции/database_analysis_corrected.md`

---

## Производительность

**Время ответа:**
- Векторный поиск: < 0.5 сек
- Переформулирование запроса (YandexGPT): ~1-2 сек
- Полный цикл (с LLM): ~3-5 сек

**Использование ресурсов:**
- RAM: ~2-3 GB (загрузка модели embeddings)
- Disk: ~500 MB (векторные базы)

---

## Поддержка и развитие

**Вопросы и предложения:**
- Создавать issues в GitHub
- Обновлять документацию в папке `инструкции/`
- Следить за качеством поиска через фронтенд

**Планы развития:**
1. Добавить ФЗ-35 "Об электроэнергетике"
2. Создать базу региональных законов
3. Создать базу FAQ по административным процедурам

---

## Контакты

**Проект:** QA система для нормативных документов ЖКХ
**Директория:** `/home/olga/normativ_docs/Волков/`
**Дата последнего обновления:** 2026-01-09

**Подробная документация:** Смотрите папку `инструкции/`
