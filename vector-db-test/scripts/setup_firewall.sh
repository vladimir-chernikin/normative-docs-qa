#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ—Ç–æ–≤
# –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º 8008 –∏ 8090 —Ç–æ–ª—å–∫–æ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö IP

echo "üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã STAZH Aspect"
echo "=============================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è ufw
if ! command -v ufw &> /dev/null; then
    echo "‚ùå ufw –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∫–∞..."
    sudo apt update
    sudo apt install -y ufw
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
echo "üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Ñ–∞–π—Ä–≤–æ–ª–∞:"
sudo ufw status verbose

echo ""
echo "üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª..."

# –†–∞–∑—Ä–µ—à–∞–µ–º SSH (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!)
echo "‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ SSH (–ø–æ—Ä—Ç 22)..."
sudo ufw allow ssh

# –†–∞–∑—Ä–µ—à–∞–µ–º HTTP –∏ HTTPS –¥–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
echo "‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ HTTP/HTTPS –¥–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞..."
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_IP_ADDRESS –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π IP!
echo ""
echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤–∞—à–∏ IP-–∞–¥—Ä–µ—Å–∞!"
echo "    –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∏ –∑–∞–º–µ–Ω–∏—Ç–µ YOUR_IP_ADDRESS"
echo "    –Ω–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º."
echo ""
echo "üí° –£–∑–Ω–∞—Ç—å –≤–∞—à —Ç–µ–∫—É—â–∏–π IP: curl ifconfig.me"
echo ""

# –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª (–û–¢–†–ï–î–ê–ö–¢–ò–†–£–ô–¢–ï –ü–ï–†–ï–î –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï–ú!)
# –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_IP_ADDRESS –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π IP
# sudo ufw allow from YOUR_IP_ADDRESS to any port 8008 comment "Backend API"
# sudo ufw allow from YOUR_IP_ADDRESS to any port 8090 comment "Frontend Web"

echo "üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é):"
echo ""
echo "# –£–∑–Ω–∞—Ç—å –≤–∞—à IP:"
echo "curl ifconfig.me"
echo ""
echo "# –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø —Å –≤–∞—à–µ–≥–æ IP (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_IP):"
echo "sudo ufw allow from YOUR_IP to any port 8008 comment 'Backend API'"
echo "sudo ufw allow from YOUR_IP to any port 8090 comment 'Frontend Web'"
echo ""
echo "# –í–∫–ª—é—á–∏—Ç—å —Ñ–∞–π—Ä–≤–æ–ª:"
echo "sudo ufw --force enable"
echo ""
echo "# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:"
echo "sudo ufw status verbose"

echo ""
echo "üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:"
echo "   1. –°–Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞–π—Ç–µ –≤–∞—à IP: curl ifconfig.me"
echo "   2. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –í–ê–®–ï–ì–û IP"
echo "   3. –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –≤–∫–ª—é—á–∞–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª!"
echo "   4. –ò–Ω–∞—á–µ –≤—ã –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç–µ —Å–µ–±–µ –¥–æ—Å—Ç—É–ø!"
