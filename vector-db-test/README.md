# Руководство по проекту Vector DB Test

Этот документ описывает полный цикл работы с проектом: от подготовки векторной базы данных до запуска бэкенда и фронтенда.

## Фаза 1: Подготовка векторной базы данных

На этом этапе исходные текстовые документы преобразуются в векторные представления (embeddings) и сохраняются в специальную базу данных (FAISS) для быстрого поиска.

### Действия

1.  **Подготовьте исходные данные:** Убедитесь, что ваши исходные `.md` файлы находятся в соответствующей директории внутри папки `data/` (например, `data/markdown_with_headers0`).
2.  **Настройте конфигурацию:** Проверьте файл `config/config.json`. В нем можно указать, какие модели использовать, пути к данным и другие параметры.
3.  **Запустите скрипт векторизации:** Для запуска процесса используйте `vectorize_integrator.py`. Этот скрипт обработает документы, создаст для них embeddings и сохранит в виде готовой векторной базы данных.

### Команда для запуска

Выполните команду из корневой папки проекта (`vector-db-test`):

```bash
# Пример для векторизации основной базы данных 'current'
python scripts/vectorize_integrator.py --database current

# Пример для векторизации базы 'zayavki'
python scripts/vectorize_integrator.py --database zayavki
```

Результат будет сохранен в соответствующую папку (`vectordb/`, `vectordb_zayavki/` и т.д.).

---

## Фаза 2: Подготовка окружения и запуск приложения

### 1. Установка зависимостей

Перед первым запуском необходимо установить все требуемые библиотеки. Рекомендуется использовать среду `conda`.

**Активируйте вашу среду conda:**
```bash
conda activate stzh311 # или stzh311cpu
```

**Установите библиотеки:**
Выполните следующую команду для установки всех необходимых пакетов для векторизации, бэкенда и работы дискриминатора/анонимайзера:
```bash
pip install fastapi uvicorn sse-starlette langchain-community faiss-cpu sentence-transformers onnxruntime transformers numpy natasha
```
**Примечание:** Если вы работаете на сервере с GPU, замените `faiss-cpu` на `faiss-gpu` для оптимальной производительности.

### 2. Запуск приложения

После подготовки окружения и БД можно запустить бэкенд (серверную часть) и фронтенд (пользовательский интерфейс).

### Запуск на GPU

1.  **Перейдите в папку проекта:** `cd vector-db-test`
2.  **Активируйте среду Conda:** `conda activate stzh311`
3.  **Запустите бэкенд:** `python run_backend_gpu.py`
4.  **В отдельном терминале запустите фронтенд:** `python run_frontend.py --mode gpu`

### Запуск на CPU

1.  **Перейдите в папку проекта:** `cd vector-db-test`
2.  **Активируйте среду Conda:** `conda activate stzh311cpu`
3.  **Запустите бэкенд:** `python run_backend_cpu.py --env dev`
4.  **В отдельном терминале запустите фронтенд:** `python run_frontend.py --mode cpu --env dev`

### Запуск на сервере (в фоновом режиме)

Для того чтобы процессы не завершались после закрытия терминала, используйте `nohup`. Команды нужно выполнять из папки `vector-db-test`.

```bash
# Запуск бэкенда в фоновом режиме с записью логов в backend.log
nohup python run_backend_cpu.py > backend.log 2>&1 &

# Запуск фронтенда в фоновом режиме с записью логов в frontend.log
nohup python run_frontend.py --mode cpu > frontend.log 2>&1 &
```
