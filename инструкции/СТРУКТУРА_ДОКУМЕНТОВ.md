# СОЗДАНИЕ СТРУКТУРЫ ДОКУМЕНТОВ

**Дата:** 2026-01-09
**Скрипт:** `/home/olga/normativ_docs/Волков/create_structure.py`
**Директория:** `/home/olga/normativ_docs/Волков/`

---

## НАЗНАЧЕНИЕ

Скрипт `create_structure.py` автоматически извлекает структуру из DOCX файлов нормативных актов и создает файлы `*_structure.txt`.

**Что делает скрипт:**
- Автоопределяет тип документа (Кодекс, Постановление, Приказ, Письмо)
- Извлекает иерархическую структуру (Разделы, Главы, Статьи, Параграфы)
- Находит приложения
- Учитывает таблицы
- Создает структурированный файл `*_structure.txt`

---

## ПОДДЕРЖИВАЕМЫЕ ТИПЫ ДОКУМЕНТОВ

### 1. CODE - Кодексы и Федеральные законы
**Примеры:** ГК РФ, ЖК РФ, ФЗ-152, ФЗ-190, ФЗ-261

**Извлекаемая структура:**
- Разделы (Раздел I, II, III...)
- Главы (Глава 1, 2, 3...)
- Статьи (Статья 1, 2, 3...)

### 2. GOVERNMENT_DECREE - Постановления Правительства РФ
**Примеры:** ПП РФ № 354, ПП РФ № 306, ПП РФ № 491

**Извлекаемая структура:**
- Разделы (I. Общие положения, II. Условия...)
- Параграфы (1., 2., 3. ...)
- Приложения (Приложение N 1, Приложение N 2...)
- Таблицы (количество)

### 3. MINISTRY_ORDER - Приказы министерств
**Примеры:** Приказ Минстроя № 938 пр, Приказ Минстроя № 44 пр

**Извлекаемая структура:**
- Разделы (если есть)
- Параграфы
- Приложения
- Таблицы

### 4. LETTER - Письма
**Примеры:** Письмо Минстроя № 9667-ОД-04

**Извлекаемая структура:**
- Базовая статистика (количество параграфов, таблиц)

---

## ИСПОЛЬЗОВАНИЕ

### Базовый синтаксис:

```bash
cd /home/olga/normativ_docs/Волков
python3 create_structure.py "Название_документа.docx"
```

### Примеры:

#### 1. Создание структуры для Постановления:

```bash
python3 create_structure.py "ПП РФ от 23.05.2006 № 306 Правила установления нормативов потребления коммунальных услуг (Правила № 306).docx"
```

**Результат:**
- Файл: `fulldocx/ПП РФ от 23.05.2006 № 306 Правила установления нормативов потребления коммунальных услуг (Правила № 306)_structure.txt`
- Содержит: 6 разделов, 51 параграф, 2 приложения, 27 таблиц

#### 2. Создание структуры для Кодекса:

```bash
python3 create_structure.py "Жилищный кодекс Российской Федерации.docx"
```

**Результат:**
- Файл: `fulldocx/Жилищный кодекс Российской Федерации_structure.txt`
- Содержит: Все разделы, главы и статьи

#### 3. Создание структуры для Приказа:

```bash
python3 create_structure.py "Приказ Минстроя РФ от 28.01.2019 № 44_пр-Об утверждении Требований к оформлению протоколов общих собраний собственников помещений в МКД.docx"
```

---

## СТРУКТУРА СОЗДАВАЕМОГО ФАЙЛА

### Пример файла структуры (ПП РФ № 306):

```
--- Структура для документа: ПП РФ от 23.05.2006 № 306 Правила установления нормативов потребления коммунальных услуг (Правила № 306).docx ---

ТИП ДОКУМЕНТА: Постановление Правительства РФ

СТАТИСТИКА:
Всего параграфов: 876
Всего таблиц: 27
Разделов: 6
Приложений: 2
Параграфов в разделах: 51

ОСНОВНАЯ ЧАСТЬ (параграфы):

I. Общие положения
  1. Настоящие Правила определяют порядок установления нормативов...
  2. В настоящих Правилах используются следующие основные понятия:
  ...

II. Условия установления нормативов потребления
  9. Установление нормативов потребления коммунальных услуг...
  ...

ПРИЛОЖЕНИЯ:

Приложение N 1 (строка 307)
Приложение N 2 (строка 798)
```

---

## МАССОВОЕ СОЗДАНИЕ СТРУКТУР

### Для всех Постановлений Правительства:

```bash
cd /home/olga/normativ_docs/Волков

# Создать скрипт для массовой обработки
cat > create_all_pp_structures.sh << 'SCRIPT'
#!/bin/bash

docs=(
  "ПП РФ от 03.04.2013 № 290 О минимальном перечне услуг и работ по содержанию общего имущества в МКД.docx"
  "ПП РФ от 06.02.2006 № 75 Об открытом конкурсе по отбору управляющей организации МКД.docx"
  "ПП РФ от 13.08.2006 № 491-Об утверждении Правил содержания общего имущества в МКД.docx"
  "ПП РФ от 14.02.2012 № 124-О правилах, обязательных при заключении договоров снабжения коммунальными ресурсами.docx"
  "ПП РФ от 15.05.2013 № 416-О порядке осуществления деятельности по управлению многоквартирными домами.docx"
  "ПП РФ от 23.05.2006 № 306 Правила установления нормативов потребления коммунальных услуг (Правила № 306).docx"
  "ПП РФ от 28.10.2014 № 1110-О лицензировании предпринимательской деятельности по управлению МКД.docx"
  "ПП РФ от 06.05.2011 № 354 Правила предоставления коммунальных услуг (Правила № 354).docx"
)

for doc in "${docs[@]}"; do
  echo "Обработка: $doc"
  python3 create_structure.py "$doc"
  echo "---"
done
SCRIPT

chmod +x create_all_pp_structures.sh
bash create_all_pp_structures.sh
```

### Для всех документов в папке:

```bash
cd /home/olga/normativ_docs/Волков/fulldocx

# Для всех DOCX файлов
for doc in *.docx; do
  echo "Обработка: $doc"
  cd ..
  python3 create_structure.py "$doc"
  cd fulldocx
done
```

---

## ПРОВЕРКА КАЧЕСТВА СТРУКТУР

### Просмотр созданного файла:

```bash
# Путь к файлу структуры
ls -lh fulldocx/*_structure.txt

# Просмотр конкретного файла
cat fulldocx/"ПП РФ от 06.05.2011 № 354 Правила предоставления коммунальных услуг (Правила № 354)_structure.txt"
```

### Анализ размера файла:

**Хороший знак:**
- Кодекс: > 100 KB (много разделов, глав, статей)
- Постановление: > 5 KB (есть разделы и параграфы)
- Приказ: > 2 KB (есть разделы)

**Плохой знак:**
- Любой документ: < 1 KB (структура не найдена)

---

## ВЫВОД СКРИПТА

При запуске скрипт показывает:

```
================================================================================
РЕЗУЛЬТАТЫ АНАЛИЗА СТРУКТУРЫ
================================================================================
Документ: ПП РФ от 23.05.2006 № 306 Правила установления нормативов...
Тип: GOVERNMENT_DECREE
Параграфов: 876
Таблиц: 27
Разделов: 6
Приложений: 2

РАЗДЕЛЫ:
  - I. Общие положения... (8 параграфов)
  - II. Условия установления нормативов потребления... (10 параграфов)
  - III. Методы установления нормативов потребления... (5 параграфов)
  ...

Файл структуры: fulldocx/..._structure.txt
```

---

## ТЕХНИЧЕСКИЕ ДЕТАЛИ

### Алгоритм работы:

1. **Чтение DOCX файла** - загрузка документа
2. **Автоопределение типа** - по названию файла
3. **Извлечение структуры** - в зависимости от типа:
   - CODE: поиск Разделов, Глав, Статей
   - GOVERNMENT_DECREE: поиск разделов (римские цифры), параграфов (арабские цифры), приложений
   - MINISTRY_ORDER: аналогично Постановлениям
   - LETTER: базовая статистика
4. **Сохранение в файл** - создание `*_structure.txt`

### Паттерны поиска:

**Кодексы:**
- Раздел: `^Раздел\s+[IVXLCDM]+` (регистронезависимо)
- Глава: `^Глава\s+\d+` (регистронезависимо)
- Статья: `^Статья\s+[\d.]+` (регистронезависимо)

**Постановления:**
- Раздел: `^[IVXLCDM]+\.\s+[А-ЯЁ]` (римская цифра с точкой, большая буква)
- Параграф: `^\d+\.` (арабская цифра с точкой)
- Приложение: `Приложение` или `ПРИЛОЖЕНИЕ`

---

## ИНТЕГРАЦИЯ С ДРУГИМИ СКРИПТАМИ

### Использование в universal_chunker.py:

Скрипт `universal_chunker.py` автоматически использует созданные структуры:

```python
chunker = UniversalDocumentChunker(docx_file, structure_file)
chunks = chunker.extract_chunks()
```

**Если структура не создана:**
- Чанкер работает в режиме "без структуры"
- Разбиение идет только по размеру (MAX_CHUNK_SIZE)
- Качество чанков хуже (нет контекста раздела/главы)

**Если структура создана:**
- Чанкер использует структуру для умного разбиения
- Чанки создаются по границам разделов/глав/статей
- Метаданные чанков содержат раздел, главу, статью

---

## ПОЧЕМУ ВАЖНА СТРУКТУРА?

### Без структуры:
- Чанки разрываются в середине мысли
- Нет привязки к разделу/главе/статье
- Плохой поиск по документу
- Неточные цитаты

### Со структурой:
- Чанки создаются по границам разделов
- Точные цитаты с номером статьи/параграфа
- Лучший поиск и релевантность
- Контекст при показе результатов

---

## РЕЗУЛЬТАТЫ НА ДАТУ СОЗДАНИЯ (2026-01-09)

### Созданные структуры для всех ПП:

| Документ | Разделов | Параграфов | Приложений | Таблиц | Статус |
|----------|----------|------------|------------|-------|--------|
| ПП РФ № 354 | 17 | 161 | 5 | 17 | ОТЛИЧНО |
| ПП РФ № 75 | 9 | 94 | 8 | 13 | ОТЛИЧНО |
| ПП РФ № 306 | 6 | 51 | 2 | 27 | ОТЛИЧНО |
| ПП РФ № 416 | 8 | 38 | 0 | 3 | ОТЛИЧНО |
| ПП РФ № 491 | 4 | 42 | 1 | 9 | ОТЛИЧНО |
| ПП РФ № 290 | 0 | 0 | 1 | 6 | ХОРОШО* |
| ПП РФ № 124 | 0 | 0 | 1 | 4 | ХОРОШО* |
| ПП РФ № 1110 | 0 | 0 | 1 | 8 | ХОРОШО* |

*Документы без разделов, только приложения

**Итого:** 8/8 документов имеют структуры

---

## КОНТАКТЫ

**Скрипт:** `/home/olga/normativ_docs/Волков/create_structure.py`
**Инструкции:** `/home/olga/normativ_docs/инструкции/`
**Дата создания:** 2026-01-09
